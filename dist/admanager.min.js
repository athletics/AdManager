/**
 * ad-manager - Generic code for GPT ad management
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/ad-manager
 * @version 0.2.0 (2014-12-03)
 */
var admanager=function(a){return"undefined"==typeof a.initialized&&(a.initialized=!1),a.bootstrap=function(){function b(b){if(a.initialized)return!1;if(admanager.config=b||!1,!admanager.config)throw new Error("Please provide config");e=jQuery,a.util.init().events.init().manager.init().insertion.init(),f=admanager.util.debug?admanager.util.debug:function(){};for(var c=0;c<g.length;c++)g[c]();return f(d+": initialized"),a.initialized=!0,a}function c(a){g.push(a)}var d="Bootstrap",e=null,f=null,g=[];return{init:b,register:c}}(),a}(admanager||{}),admanager=function(a,b){return a.events=function(b){function c(){return f=admanager.util.debug?admanager.util.debug:function(){},f(e+": initialized"),d(),a}function d(){b(document).on("scroll",function(){window.requestAnimationFrame(function(){b.event.trigger("GPT:scroll"),b.event.trigger("GPT:updateUI")})}).on("resize",function(){window.requestAnimationFrame(function(){b.event.trigger("GPT:resize"),b.event.trigger("GPT:updateUI")})})}var e="Events",f=null;return{init:c}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.insertion=function(b){function c(){return r=admanager.util.debug?admanager.util.debug:function(){},r(q+": initialized"),e()?(s=b(a.config.insertion_selector).first(),t=b(".app_ad_insert_after"),s.length>0&&(u=!0),t.length>0&&(v=!0),u||v?(w=a.manager.get_dynamic_inventory(),f(),a):(d(),a)):(d(),a)}function d(){b.event.trigger("GPT:unitsInserted")}function e(){var b=a.util.page_config();return"undefined"==typeof b.insertion_enabled?!1:b.insertion_enabled}function f(){u&&(g(),j(),k()),v&&l(),d()}function g(){var a=s.children(),c=["img","iframe","video","audio",".video",".audio",".app_ad_unit"];a.each(function(d){var e=b(this),f=d>0?a.eq(d-1):!1,g=!0;b.each(c,function(a,b){return e.is(b)||e.find(b).length>0?(g=!1,!1):void 0}),f&&f.is("p")&&1===f.find("img").length&&(g=!1),e.data("valid-location",g)})}function h(a){return a.data("valid-location")}function i(b,c){c=c||!1;var d=a.util.get_unit_type(b),e=y?"odd":"even",f='<div class="app_ad_unit in_content '+e+'" data-type="'+d+'" data-id="'+b+'"></div>',g='<div class="app_ad_unit disable_float" data-type="'+d+'" data-id="'+b+'"></div>';return c||(y=!y),c?g:f}function j(){var a=n(),b=admanager.util.tallest_available(a),c=admanager.util.shortest_available(a),d=o({height:b,limit:1e3}),e=null;d||(d=o({height:c,limit:1e3,force:!0}),d.disable_float||(a=admanager.util.limit_unit_height(a,c))),e=i(a.id,d.disable_float),d.$insert_before.before(e)}function k(){b.each(w,function(a,b){var c=admanager.util.tallest_available(b),d=o({height:c}),e=null;return d?(e=i(b.id,d.disable_float),void d.$insert_before.before(e)):!1})}function l(){t.each(function(){var a=m(),c=null;return a?(c=i(a.id,!0),void b(this).after(c)):!1})}function m(){var a=!1;return b.each(w,function(c,d){return 0!==b('[data-id="'+d.id+'"]').length?!0:(a=d,!1)}),a}function n(){var a=!1;return b.each(w,function(b,c){return c.primary===!0?(a=c,w.remove(b),!1):void 0}),a||(a=w[0],w.remove(0)),a}function o(a){a=a||{};var c=p(),d=null,e=[],f=0,g=0,i=a.limit?a.limit:!1,j=a.force?a.force:!1,k=40,l=a.height-k,m=800,n=!1,o=!1;return c.length<1?!1:(c.each(function(a){var k=b(this),p=(a>0?c.eq(a-1):!1,k.offset().top),q=p-x,r=k.outerHeight(),s=c.length-1===a;if(f+=r,j&&(f>=i||s))return d=k,o=!0,n=!0,!1;if(i&&(f>=i||s))return n=!1,!1;if(h(k)){if(g+=r,e.push(k),null===d&&(d=k),g>=l)return i===!1&&m>q?(g=0,d=null,!0):(n=!0,!1)}else g=0,d=null}),n?(e.length>0&&b.each(e,function(a,c){b(c).data("valid-location",!1)}),x=d.offset().top+l,{$insert_before:d,disable_float:o}):!1)}function p(){var a=s.find(".app_ad_unit").last(),b=null;return b=a.length>0?a.nextAll(s):s.children()}var q="Insertion",r=null,s=null,t=null,u=!1,v=!1,w=[],x=0,y=!0;return{init:c}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.manager=function(b){function c(){return x=admanager.util.debug?admanager.util.debug:function(){},x(w+": initialized"),a.util.enabled()?(A=e(),B=a.config.account,d(),a):a}function d(){b(document).on("GPT:unitsInserted",function(){x(w+": GPT:unitsInserted"),h()}).on("GPT:libraryLoaded",function(){x(w+": GPT:libraryLoaded"),j(),k(),l(),m(),n()}).on("GPT:slotsDefined",function(){x(w+": GPT:slotsDefined"),o()})}function e(){return g(f(a.config.inventory))}function f(a){for(var b=0;b<a.length;b++)"undefined"==typeof a[b].type&&(a[b].type="default");return a}function g(b){var c=window.innerWidth>0?window.innerWidth:screen.width;if(c>1024)return b;if(c>=768&&1024>=c)for(var d=980,e=0;e<b.length;e++){for(var f=[],g=0;g<b[e].sizes.length;g++)b[e].sizes[g][0]>d&&f.push(b[e].sizes[g]);b[e].sizes=a.util.difference(b[e].sizes,f)}return b}function h(){var a,b,c,d,e=!1;window.googletag=window.googletag||{},a=window.googletag,a.cmd=a.cmd||[],b=document.createElement("script"),b.async=!0,b.type="text/javascript",c="https:"==document.location.protocol,b.src=(c?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",b.addEventListener?b.addEventListener("load",i,!1):b.readyState&&(b.onreadystatechange=function(){e||(e=!0,i())}),d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(b,d)}function i(){googletag.cmd.push(function(){b.event.trigger("GPT:libraryLoaded")})}function j(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",function(a){p(a)})})}function k(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad()})}function l(){googletag.cmd.push(function(){var c=a.util.page_config(),d=c.targeting;"undefined"!=typeof d&&b.each(d,function(a,b){googletag.pubads().setTargeting(a,b)})})}function m(){var c="undefined"!=typeof a.config.type?a.config.type:!1,d=b(c?'.app_ad_unit[data-type="'+c+'"]':".app_ad_unit");d.each(function(){var a=b(this),c=a.data("id");z.push(c)})}function n(){var a=null;googletag.cmd.push(function(){for(var c=0;c<z.length;c++)if(q(z[c]),a=r(z[c]),"undefined"!=typeof a.id){var d=b('.app_ad_unit[data-id="'+a.id+'"]');d.length<1||(d.html('<div class="app_unit_target" id="'+a.id_name+'"></div>'),d.addClass("active"),y[c]=googletag.defineSlot("/"+B+"/"+a.slot,a.sizes,a.id_name).addService(googletag.pubads()))}googletag.enableServices(),b.event.trigger("GPT:slotsDefined")})}function o(){googletag.cmd.push(function(){googletag.pubads().refresh(y);for(var a=0;a<z.length;a++)current_position=r(z[a]),b("#"+current_position.id_name).length>0&&googletag.display(current_position.id_name)})}function p(a){var c=a.slot.getAdUnitPath().replace("/"+B+"/","");b.event.trigger("GPT:adUnitRendered",{name:c,size:a.size})}function q(a){for(var b=0;b<A.length;b++)if(A[b].id===a||A[b].slot===a)return"undefined"==typeof A[b].iteration&&(A[b].iteration=0),void(A[b].iteration=A[b].iteration+1)}function r(a){for(var b={},c=0;c<A.length;c++)if(A[c].id===a||A[c].slot===a)return b=A[c],b.id_name="undefined"==typeof b.use_iterator||b.use_iterator?b.id+"_"+b.iteration:b.id,b;return b}function s(a){var c=null;return b.each(y,function(b,d){var e=d.getAdUnitPath().replace("/"+B+"/","");return e===a?(c=d,!1):void 0}),c}function t(a){googletag.cmd.push(function(){var b=r(a),c=s(b.slot);googletag.pubads().refresh([c]),googletag.display(b.id_name),u(b.slot)})}function u(a){b.each(y,function(b,c){var d=c.getAdUnitPath().replace("/"+B+"/","");d===a&&y.remove(b)})}function v(){var c=[],d="undefined"!=typeof a.config.type?a.config.type:!1;return b.each(A,function(a,b){b.dynamic===!0&&(d&&d!==b.type||c.push(b))}),c}var w="Manager",x=null,y=[],z=[],A=[],B=null;return{init:c,get_ad_info:r,display_slot:t,remove_defined_slot:u,get_dynamic_inventory:v}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.util=function(b){function c(){return d(n+": initialized"),h(),g(),a}function d(a){o&&"object"==typeof console&&console.log&&console.log(a)}function e(){var a=i();return"undefined"==typeof a.admanager_enabled?!0:a.admanager_enabled}function f(a,c){var d=[];return b.grep(a,function(a){-1===b.inArray(a,c)&&d.push(a)}),d}function g(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame}function h(){Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)}}function i(){if("undefined"==typeof a.config.page_config_selector)return{};var c=b(a.config.page_config_selector).data("page-config");return"object"!=typeof c?{}:c}function j(a){var c=0;return b.each(a.sizes,function(a,b){0===c?c=b[1]:b[1]<c&&(c=b[1])}),c}function k(a){var c=0;return b.each(a.sizes,function(a,b){b[1]>c&&(c=b[1])}),c}function l(a,c){return b.each(a.sizes,function(b,d){return d[1]<=c?!0:void a.sizes.remove(b)}),a}function m(c){var d="default";return b.each(a.config.inventory,function(a,b){return b.id!==c?!0:(d=b.type,!1)}),d}var n="Util",o=!1;return{init:c,debug:d,enabled:e,difference:f,page_config:i,shortest_available:j,tallest_available:k,limit_unit_height:l,get_unit_type:m}}(b),a}(admanager||{},jQuery);
window.AdManager = admanager.bootstrap.init;