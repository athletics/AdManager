/**
 * ad-manager - Generic code for GPT ad management
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/ad-manager
 * @version 0.2.0 (2014-12-17)
 */
var admanager=function(a){return"undefined"==typeof a.initialized&&(a.initialized=!1),a.bootstrap=function(){function b(b){if(a.initialized)return!1;if(admanager.config=b||!1,!admanager.config)throw new Error("Please provide config");e=jQuery,f=admanager.util.debug?admanager.util.debug:function(){},a.util.init().manager.init().insertion.init();for(var c=0;c<g.length;c++)g[c]();return f(d+": initialized"),a.initialized=!0,a}function c(a){g.push(a)}var d="Bootstrap",e=null,f=null,g=[];return{init:b,register:c}}(),a}(admanager||{}),admanager=function(a,b){return a.insertion=function(b){function c(){s=admanager.util.debug?admanager.util.debug:function(){},s(r+": initialized"),z=b.extend(z,a.manager.get_defaults()),d()}function d(){b(document).on("GPT:initSequence",function(){s(r+": GPT:initSequence"),f()})}function e(){t=a.util.get_context()}function f(){var b=a.manager.get_dynamic_inventory();return e(),w=w.length>0?w:b.dynamic_items,y=y?y:b.local_context,w.length<1?(g(),a):(u=t.find(y).first(),u.length>0&&(v=!0),v?(h(),a):(g(),a))}function g(){b.event.trigger("GPT:unitsInserted")}function h(){v&&(i(),l(),m()),g()}function i(){var c=u.children(),d=a.config.insert_exclusion||z.insert_exclusion;c.each(function(a){var e=b(this),f=a>0?c.eq(a-1):!1,g=!0;b.each(d,function(a,b){return e.is(b)||e.find(b).length>0?(g=!1,!1):void 0}),f&&f.is("p")&&1===f.find("img").length&&(g=!1),e.attr("data-valid-location",g)})}function j(a){return a.data("valid-location")}function k(c,d){var e=d||!1,f=a.util.get_unit_type(c),g=x?"odd":"even",h=b("<div/>");return h.addClass(z.ad_class).attr("data-id",c).attr("data-client-type",f),e?h.addClass("disable_float"):h.addClass("in_content").addClass(g),e||(x=!x),h}function l(){var a=n(),b=admanager.util.tallest_available(a),c=admanager.util.shortest_available(a),d=o({height:b,limit:z.ad_height_limit}),e=null;d||(d=o({height:c,limit:z.ad_height_limit,force:!0}),d.disable_float||(a=admanager.util.limit_unit_height(a,c))),e=k(a.id,d.disable_float),d.$insert_before.before(e)}function m(){b.each(w,function(a,b){var c=admanager.util.tallest_available(b),d=o({height:c}),e=null;return d?(e=k(b.id,d.disable_float),void d.$insert_before.before(e)):!1})}function n(){var a=!1;return b.each(w,function(b,c){return c.primary===!0?(a=c,w.remove(b),!1):void 0}),a||(a=w[0],w.remove(0)),a}function o(a){a=a||{};var c=q(),d=new p({$nodes:c,force:a.force?a.force:!1,limit:a.limit?a.limit:!1,height:a.height});return c.length<1?!1:(b.each(c,function(a,c){var e=d.verify_node(a,b(c));return e===!0?!1:e===!1?!0:void 0}),d.location_found?(d.mark_valid_nodes(),d.set_last_position(),{$insert_before:d.$insert_before,disable_float:d.disable_float}):!1)}function p(a){this.total_height=0,this.margin_difference=40,this.inserted=[],this.$insert_before=null,this.disable_float=!1,this.location_found=!1,this.valid_height=0,this.exit_loop=!1,this.height=a.height,this.force=a.force,this.limit=a.limit,this.$nodes=a.$nodes,this.last_position=0,this.needed_height=a.height-this.margin_difference}function q(){var a=u.find(z.ad_selector).last(),b=null;return b=a.length>0?a.nextAll(u):u.children()}var r="Insertion",s=null,t=null,u=null,v=!1,w=[],x=!0,y=null,z={px_between_units:800,ad_height_limit:1e3,insert_exclusion:["img","iframe","video","audio",".video",".audio",".app_ad_unit"]};return p.prototype.set_last_position=function(){this.last_position=this.$insert_before.offset().top+this.needed_height},p.prototype.mark_valid_nodes=function(){this.inserted.length>0&&b.each(this.inserted,function(a,c){b(c).data("valid-location",!1)})},p.prototype.verify_node=function(a,b){var c=b.offset().top-this.last_position,d=b.outerHeight(),e=this.$nodes.length-1===a;return this.total_height+=d,this.force&&(this.total_height>=this.limit||e)?(this.$insert_before=b,this.disable_float=!0,this.location_found=!0,this.exit_loop=!0):this.limit&&(this.total_height>=this.limit||e)?(this.location_found=!1,this.exit_loop=!0):j(b)?(this.valid_height+=d,this.inserted.push(b),null===this.$insert_before&&(this.$insert_before=b),this.valid_height>=this.needed_height&&(this.limit===!1&&c<z.px_between_units&&(this.valid_height=0,this.$insert_before=null),this.location_found=!0,this.exit_loop=!0)):(this.valid_height=0,this.$insert_before=null,this.exit_loop=null),this.exit_loop},{init:c}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.manager=function(b){function c(){return C=admanager.util.debug?admanager.util.debug:function(){},C(B+": initialized"),y()?(H.ad_selector="."+H.ad_class,F=f(),G=a.config.account,d(),i(),a):a}function d(){b(document).on("GPT:unitsInserted",function(){C(B+": GPT:unitsInserted")}).on("GPT:libraryLoaded",function(){C(B+": GPT:libraryLoaded"),e()}).on("GPT:slotsDefined",function(){C(B+": GPT:slotsDefined"),p()})}function e(){b.event.trigger("GPT:initSequence"),k(),l(),m(),n(),o()}function f(){return h(g(a.config.inventory))}function g(a){for(var b=0;b<a.length;b++)"undefined"==typeof a[b].type&&(a[b].type="default");return a}function h(b){var c=window.innerWidth>0?window.innerWidth:screen.width;if(c>1024)return b;if(c>=768&&1024>=c)for(var d=980,e=0;e<b.length;e++){for(var f=[],g=0;g<b[e].sizes.length;g++)b[e].sizes[g][0]>d&&f.push(b[e].sizes[g]);b[e].sizes=a.util.difference(b[e].sizes,f)}return b}function i(){var a,b,c,d,e=!1;window.googletag=window.googletag||{},a=window.googletag,a.cmd=a.cmd||[],b=document.createElement("script"),b.async=!0,b.type="text/javascript",c="https:"==document.location.protocol,b.src=(c?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",b.addEventListener?b.addEventListener("load",j,!1):b.readyState&&(b.onreadystatechange=function(){e||(e=!0,j())}),d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(b,d)}function j(){googletag.cmd.push(function(){b.event.trigger("GPT:libraryLoaded")})}function k(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",function(a){q(a)})})}function l(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad()})}function m(){googletag.cmd.push(function(){var a=x(),c=a.targeting;"undefined"!=typeof c&&b.each(c,function(a,b){googletag.pubads().setTargeting(a,b)})})}function n(){var c="undefined"!=typeof a.config.client_type?a.config.client_type:!1,d=a.util.get_context(),e=null,f=H.ad_selector;c!==!1&&(f+='[data-client-type="'+c+'"]'),e=d.find(f),e.each(function(){var a=b(this).data("id");E.push(a)})}function o(){googletag.cmd.push(function(){for(var c,d,e=null,f=a.util.get_context(),g=0;g<E.length;g++)r(E[g]),e=s(E[g]),"undefined"!=typeof e.id&&(c=f.find(H.ad_selector+'[data-id="'+e.id+'"]'),d=b("<div/>"),c.length<1||(d.addClass(H.ad_unit_target_class),d.attr("id",e.id_name),c.append(d),c.addClass("active"),D[g]=googletag.defineSlot("/"+G+"/"+e.slot,e.sizes,e.id_name).addService(googletag.pubads())));googletag.enableServices(),b.event.trigger("GPT:slotsDefined")})}function p(){googletag.cmd.push(function(){googletag.pubads().refresh(D);for(var a=0;a<E.length;a++)current_position=s(E[a]),b("#"+current_position.id_name).length>0&&googletag.display(current_position.id_name)})}function q(a){var c=a.slot.getAdUnitPath().replace("/"+G+"/","");b.event.trigger("GPT:adUnitRendered",{name:c,size:a.size})}function r(a){for(var b=0;b<F.length;b++)if(F[b].id===a||F[b].slot===a)return"undefined"==typeof F[b].iteration&&(F[b].iteration=0),void(F[b].iteration=F[b].iteration+1)}function s(a){for(var b={},c=0;c<F.length;c++)if(F[c].id===a||F[c].slot===a)return b=F[c],b.id_name="undefined"==typeof b.use_iterator||b.use_iterator?b.id+"_"+b.iteration:b.id,b;return b}function t(a){var c=null;return b.each(D,function(b,d){var e=d.getAdUnitPath().replace("/"+G+"/","");return e===a?(c=d,!1):void 0}),c}function u(a){googletag.cmd.push(function(){var b=s(a),c=t(b.slot);googletag.pubads().refresh([c]),googletag.display(b.id_name),v(b.slot)})}function v(a){b.each(D,function(b,c){var d=c.getAdUnitPath().replace("/"+G+"/","");d===a&&D.remove(b)})}function w(){var c,d=[],e="undefined"!=typeof a.config.client_type?a.config.client_type:!1;return b.each(F,function(a,b){"undefined"!=typeof b.dynamic&&b.dynamic===!0&&(e&&e!==b.type||(d.push(b),c=b.local_context))}),{dynamic_items:d,local_context:c}}function x(){return a.config}function y(){var b=a.util.get_context(),c="page-ad-config";return"undefined"!=typeof a.config.page_config_attr&&(c=a.config.page_config_attr),a.config=a.util.import_config({$context:b,attr_name:c,exist_config:a.config}),"undefined"==typeof a.config.enabled?!0:a.config.enabled}function z(a){var b=a.$context,c=a.remove_container||!1;b.find(H.ad_selector).empty(),c&&b.find(H.ad_selector).remove()}function A(){return H}var B="Manager",C=null,D=[],E=[],F=[],G=null,H={ad_class:"app_ad_unit",ad_unit_target_class:"app_unit_target",ad_selector:""};return{init:c,is_enabled:y,get_config:x,get_defaults:A,get_ad_info:s,display_slot:u,remove_defined_slot:v,get_dynamic_inventory:w,init_sequence:e,empty_ads:z}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.util=function(b){function c(){return d(m+": initialized"),f(),a}function d(a){n&&"object"==typeof console&&console.log&&console.log(a)}function e(a,c){var d=[];return b.grep(a,function(a){-1===b.inArray(a,c)&&d.push(a)}),d}function f(){Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)}}function g(a){var c,d,e=a.$context,f=a.attr_name,g=a.exist_config,h={};return c="*[data-"+f+"]",d=b.extend({},g),h=e.find(c).data(f),"object"==typeof d&&(d=b.extend(d,h)),d}function h(){var c=a.config.context||"body";return b(c)}function i(a){var c=0;return b.each(a.sizes,function(a,b){0===c?c=b[1]:b[1]<c&&(c=b[1])}),c}function j(a){var c=0;return b.each(a.sizes,function(a,b){b[1]>c&&(c=b[1])}),c}function k(a,c){return b.each(a.sizes,function(b,d){return d[1]<=c?!0:void a.sizes.remove(b)}),a}function l(c){var d="default";return b.each(a.config.inventory,function(a,b){return b.id!==c?!0:(d=b.type,!1)}),d}var m="Util",n=!1;return{init:c,debug:d,difference:e,import_config:g,shortest_available:i,tallest_available:j,limit_unit_height:k,get_unit_type:l,get_context:h}}(b),a}(admanager||{},jQuery);
window.AdManager = admanager.bootstrap.init;