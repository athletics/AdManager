/**
 * ad-manager - Generic code for GPT ad management
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/ad-manager
 * @version 0.3.0 ( 2015-05-19 )
 */
var admanager=function(a){return"undefined"==typeof a.initialized&&(a.initialized=!1),a.bootstrap=function(){function b(b){if(a.initialized)return!1;if(admanager.config=b||!1,!admanager.config)throw new Error("Please provide config");e=admanager.util.debug?admanager.util.debug:function(){},a.util.init().manager.init().insertion.init();for(var c=0;c<f.length;c++)f[c]();return e(d+": initialized"),a.initialized=!0,a}function c(a){f.push(a)}var d="Bootstrap",e=null,f=[];return{init:b,register:c}}(),a}(admanager||{},jQuery),admanager=function(a,b){return a.insertion=function(b){function c(){s=admanager.util.debug?admanager.util.debug:function(){},s(r+": initialized"),z=b.extend(z,a.manager.getDefaults()),d()}function d(){b(document).on("GPT:initSequence",function(){s(r+": GPT:initSequence"),f()})}function e(){t=a.util.getContext()}function f(){var b=a.manager.getDynamicInventory();return e(),w=w.length?w:b.dynamicItems,y=y?y:b.localContext,w.length?(u=t.find(y).first(),u.length&&(v=!0),v?(h(),a):(g(),a)):(g(),a)}function g(){b.event.trigger("GPT:unitsInserted")}function h(){v&&(i(),l(),m()),g()}function i(){var c=u.children(),d=a.config.insertExclusion||z.insertExclusion;c.each(function(a){var e=b(this),f=a>0?c.eq(a-1):!1,g=!0;b.each(d,function(a,b){return e.is(b)||e.find(b).length?(g=!1,!1):void 0}),f&&f.is("p")&&1===f.find("img").length&&(g=!1),e.attr("data-valid-location",g)})}function j(a){return a.data("valid-location")}function k(c,d){var e=d||!1,f=a.util.getUnitType(c),g=x?"odd":"even",h=b("<div />");return h.addClass(z.adClass).attr("data-id",c).attr("data-client-type",f),e?h.addClass("disableFloat"):h.addClass("inContent").addClass(g),e||(x=!x),h}function l(){var a=n(),b=admanager.util.tallestAvailable(a),c=admanager.util.shortestAvailable(a),d=o({height:b,limit:z.adHeightLimit}),e=null;d||(d=o({height:c,limit:z.adHeightLimit,force:!0}),d.disableFloat||(a=admanager.util.limitUnitHeight(a,c))),e=k(a.id,d.disableFloat),d.$insertBefore.before(e)}function m(){b.each(w,function(a,b){var c=admanager.util.tallestAvailable(b),d=o({height:c}),e=null;return d?(e=k(b.id,d.disableFloat),void d.$insertBefore.before(e)):!1})}function n(){var a=!1;return b.each(w,function(b,c){return c.primary?(a=c,w.remove(b),!1):void 0}),a||(a=w[0],w.remove(0)),a}function o(a){a=a||{};var c=q(),d=new p({$nodes:c,force:a.force?a.force:!1,limit:a.limit?a.limit:!1,height:a.height});return c.length?(b.each(c,function(a,c){var e=d.verifyNode(a,b(c));return e?!1:e?void 0:!0}),d.locationFound?(d.markValidNodes(),d.setLastPosition(),{$insertBefore:d.$insertBefore,disableFloat:d.disableFloat}):!1):!1}function p(a){this.totalHeight=0,this.marginDifference=40,this.inserted=[],this.$insertBefore=null,this.disableFloat=!1,this.locationFound=!1,this.validHeight=0,this.exitLoop=!1,this.height=a.height,this.force=a.force,this.limit=a.limit,this.$nodes=a.$nodes,this.lastPosition=0,this.neededheight=a.height-this.marginDifference}function q(){var a=u.find(z.adSelector).last(),b=null;return b=a.length?a.nextAll(u):u.children()}var r="Insertion",s=null,t=null,u=null,v=!1,w=[],x=!0,y=null,z={pxBetweenUnits:800,adHeightLimit:1e3,insertExclusion:["img","iframe","video","audio",".video",".audio",".app_ad_unit"]};return p.prototype.setLastPosition=function(){this.lastPosition=this.$insertBefore.offset().top+this.neededheight},p.prototype.markValidNodes=function(){this.inserted.length&&b.each(this.inserted,function(a,c){b(c).data("valid-location",!1)})},p.prototype.verifyNode=function(a,b){var c=b.offset().top-this.lastPosition,d=b.outerHeight(),e=this.$nodes.length-1===a;return this.totalHeight+=d,this.force&&(this.totalHeight>=this.limit||e)?(this.$insertBefore=b,this.disableFloat=!0,this.locationFound=!0,this.exitLoop=!0):this.limit&&(this.totalHeight>=this.limit||e)?(this.locationFound=!1,this.exitLoop=!0):j(b)?(this.validHeight+=d,this.inserted.push(b),null===this.$insertBefore&&(this.$insertBefore=b),this.validHeight>=this.neededheight&&(!this.limit&&c<z.pxBetweenUnits&&(this.validHeight=0,this.$insertBefore=null),this.locationFound=!0,this.exitLoop=!0)):(this.validHeight=0,this.$insertBefore=null,this.exitLoop=null),this.exitLoop},{init:c}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.manager=function(b){function c(){return C=admanager.util.debug?admanager.util.debug:function(){},C(B+": initialized"),y()?(H.adSelector="."+H.adClass,F=f(),G=a.config.account,d(),i(),a):a}function d(){b(document).on("GPT:unitsInserted",function(){C(B+": GPT:unitsInserted")}).on("GPT:libraryLoaded",function(){C(B+": GPT:libraryLoaded"),e()}).on("GPT:slotsDefined",function(){C(B+": GPT:slotsDefined"),p()})}function e(){b.event.trigger("GPT:initSequence"),k(),l(),m(),n(),o()}function f(){return h(g(a.config.inventory))}function g(a){for(var b=0;b<a.length;b++)"undefined"==typeof a[b].type&&(a[b].type="default");return a}function h(b){var c=window.innerWidth>0?window.innerWidth:screen.width;if(c>1024)return b;if(c>=768&&1024>=c)for(var d=980,e=0;e<b.length;e++){for(var f=[],g=0;g<b[e].sizes.length;g++)b[e].sizes[g][0]>d&&f.push(b[e].sizes[g]);b[e].sizes=a.util.difference(b[e].sizes,f)}return b}function i(){var a,b,c,d,e=!1;window.googletag=window.googletag||{},a=window.googletag,a.cmd=a.cmd||[],b=document.createElement("script"),b.async=!0,b.type="text/javascript",c="https:"==document.location.protocol,b.src=(c?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",b.addEventListener?b.addEventListener("load",j,!1):b.readyState&&(b.onreadystatechange=function(){e||(e=!0,j())}),d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(b,d)}function j(){googletag.cmd.push(function(){b.event.trigger("GPT:libraryLoaded")})}function k(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",function(a){q(a)})})}function l(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad()})}function m(){googletag.cmd.push(function(){var a=x(),c=a.targeting;"undefined"!=typeof c&&b.each(c,function(a,b){googletag.pubads().setTargeting(a,b)})})}function n(){var c="undefined"!=typeof a.config.clientType?a.config.clientType:!1,d=a.util.getContext(),e=null,f=H.adSelector;c!==!1&&(f+='[data-client-type="'+c+'"]'),e=d.find(f),e.each(function(){var a=b(this).data("id");E.push(a)})}function o(){googletag.cmd.push(function(){for(var c,d,e=null,f=a.util.getContext(),g=0;g<E.length;g++)r(E[g]),e=s(E[g]),"undefined"!=typeof e.id&&(c=f.find(H.adSelector+'[data-id="'+e.id+'"]'),d=b("<div />"),c.length<1||(d.addClass(H.adUnitTargetClass),d.attr("id",e.idName),c.append(d),c.addClass("active"),D[g]=googletag.defineSlot("/"+G+"/"+e.slot,e.sizes,e.idName).addService(googletag.pubads())));googletag.enableServices(),b.event.trigger("GPT:slotsDefined")})}function p(){googletag.cmd.push(function(){googletag.pubads().refresh(D);for(var a=0;a<E.length;a++)currentPosition=s(E[a]),b("#"+currentPosition.idName).length&&googletag.display(currentPosition.idName)})}function q(a){var c=a.slot.getAdUnitPath().replace("/"+G+"/",""),d=s(c);b.event.trigger("GPT:adUnitRendered",{name:c,id:d.id,size:a.size,isEmpty:a.isEmpty,creativeId:a.creativeId,lineItemId:a.lineItemId,serviceName:a.serviceName})}function r(a){for(var b=0;b<F.length;b++)if(F[b].id===a||F[b].slot===a)return"undefined"==typeof F[b].iteration&&(F[b].iteration=0),void(F[b].iteration=F[b].iteration+1)}function s(a){for(var b={},c=0;c<F.length;c++)if(F[c].id===a||F[c].slot===a)return b=F[c],b.idName="undefined"==typeof b.useIterator||b.useIterator?b.id+"_"+b.iteration:b.id,b;return b}function t(a){var c=null;return b.each(D,function(b,d){var e=d.getAdUnitPath().replace("/"+G+"/","");return e===a?(c=d,!1):void 0}),c}function u(a){googletag.cmd.push(function(){var b=s(a),c=t(b.slot);googletag.pubads().refresh([c]),googletag.display(b.idName),v(b.slot)})}function v(a){b.each(D,function(b,c){var d=c.getAdUnitPath().replace("/"+G+"/","");d===a&&D.remove(b)})}function w(){var c,d=[],e="undefined"!=typeof a.config.clientType?a.config.clientType:!1;return b.each(F,function(a,b){"undefined"!=typeof b.dynamic&&b.dynamic===!0&&(e&&e!==b.type||(d.push(b),c=b.localContext))}),{dynamicItems:d,localContext:c}}function x(){return a.config}function y(){var b=a.util.getContext(),c="page-ad-config";return"undefined"!=typeof a.config.pageConfigAttr&&(c=a.config.pageConfigAttr),a.config=a.util.importConfig({$context:b,attrName:c,existConfig:a.config}),"undefined"==typeof a.config.enabled?!0:a.config.enabled}function z(a){var b=a.$context,c=a.removeContainer||!1;b.find(H.adSelector).empty(),c&&b.find(H.adSelector).remove()}function A(){return H}var B="Manager",C=null,D=[],E=[],F=[],G=null,H={adClass:"app_ad_unit",adUnitTargetClass:"app_unit_target",adSelector:""};return{init:c,isEnabled:y,getConfig:x,getDefaults:A,getAdInfo:s,displaySlot:u,removeDefinedSlot:v,getDynamicInventory:w,initSequence:e,emptyAds:z}}(b),a}(admanager||{},jQuery),admanager=function(a,b){return a.util=function(b){function c(){return d(m+": initialized"),f(),a}function d(a){n&&"object"==typeof console&&console.log&&console.log(a)}function e(a,c){var d=[];return b.grep(a,function(a){-1===b.inArray(a,c)&&d.push(a)}),d}function f(){Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)}}function g(a){var c,d,e=a.$context,f=a.attrName,g=a.existConfig,h={};return c="*[data-"+f+"]",d=b.extend({},g),h=e.find(c).data(f),"object"==typeof d&&(d=b.extend(d,h)),d}function h(){var c=a.config.context||"body";return b(c)}function i(a){var c=0;return b.each(a.sizes,function(a,b){0===c?c=b[1]:b[1]<c&&(c=b[1])}),c}function j(a){var c=0;return b.each(a.sizes,function(a,b){b[1]>c&&(c=b[1])}),c}function k(a,c){return b.each(a.sizes,function(b,d){return d[1]<=c?!0:void a.sizes.remove(b)}),a}function l(c){var d="default";return b.each(a.config.inventory,function(a,b){return b.id!==c?!0:(d=b.type,!1)}),d}var m="Util",n=!1;return{init:c,debug:d,difference:e,importConfig:g,shortestAvailable:i,tallestAvailable:j,limitUnitHeight:k,getUnitType:l,getContext:h}}(b),a}(admanager||{},jQuery);
window.AdManager = admanager.bootstrap.init;