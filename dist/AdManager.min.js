/*!
 * AdManager - A JavaScipt library for interacting with Google DFP.
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/ad-manager
 * @version 0.4.3
 */

!function(e,t){"function"==typeof define&&define.amd?define("src/Util",["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):(e.AdManager=e.AdManager||{},e.AdManager.Util=t(e.jQuery))}(window,function(e){function t(t,n){var i=[];return e.grep(t,function(t){-1===e.inArray(t,n)&&i.push(t)}),i}function n(t,n){return t=e.grep(t,function(e,t){return t!==n})}var i=function(){return"object"==typeof console&&console.log?console.log.bind(console):void 0}();return{debug:i,difference:t,removeByKey:n}}),function(e,t){"function"==typeof define&&define.amd?define("src/Config",["jquery","./Util"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("./Util")):(e.AdManager=e.AdManager||{},e.AdManager.Config=t(e.jQuery,e.AdManager.Util))}(window,function(e,t){function n(t){u=e.extend(l,t)}function i(e,t){return r(u,e,t)}function o(e){if(e=e||!1,!e)return u;var t=e.indexOf("Selector",this.length-"Selector".length);return-1!==t?(e=e.slice(0,t)+"Class","."+a(u,e).replace(/^\./,"")):a(u,e)}function r(e,t,n){return"string"==typeof t&&(t=t.split(".")),t.length>1?r(e[t.shift()],t,n):e[t[0]]=n,e}function a(e,t){return"string"==typeof t&&(t=t.split(".")),t.length>1?a(e[t.shift()],t):t[0]in e?e[t[0]]:null}function d(t){var n,i,o=t.$context,r=t.attrName,a=t.existConfig,d={};return n="*[data-"+r+"]",i=e.extend({},a),d=o.find(n).data(r),"object"==typeof i&&(i=e.extend(i,d)),i}var s=!0,u=(s?t.debug:function(){},{}),l={account:null,adClass:"app_ad_unit",adUnitTargetClass:"app_unit_target",clientType:!1,context:"body",enabled:!0,insertionEnabled:!1,insertion:{pxBetweenUnits:800,adHeightLimit:1e3,insertExclusion:["img","iframe","video","audio",".video",".audio",".app_ad_unit"]},inventory:[],pageConfigAttr:!1,targeting:[]};return{init:n,set:i,get:o,importConfig:d}}),function(e,t){"function"==typeof define&&define.amd?define("src/Inventory",["jquery","./Util","./Config"],function(n,i,o){return t(e,n,i,o)}):"object"==typeof exports?module.exports=t(e,require("jquery"),require("./Util"),require("./Config")):(e.AdManager=e.AdManager||{},e.AdManager.Inventory=t(e,e.jQuery,e.AdManager.Util,e.AdManager.Config))}(window,function(e,t,n,i){function o(){return a(r(i.get("inventory")))}function r(e){for(var t=0;t<e.length;t++)"undefined"==typeof e[t].type&&(e[t].type="default");return e}function a(t){var i=e.innerWidth>0?e.innerWidth:screen.width;if(i>1024)return t;if(i>=768&&1024>=i)for(var o=980,r=0;r<t.length;r++){for(var a=[],d=0;d<t[r].sizes.length;d++)t[r].sizes[d][0]>o&&a.push(t[r].sizes[d]);t[r].sizes=n.difference(t[r].sizes,a)}return t}function d(){var e,n=[],r=i.get("clientType"),a=o();return t.each(a,function(t,i){"undefined"!=typeof i.dynamic&&i.dynamic===!0&&(r&&r!==i.type||(n.push(i),e=i.localContext))}),{dynamicItems:n,localContext:e}}function s(e){for(var t={},n=o(),i=0;i<n.length;i++)if(n[i].id===e||n[i].slot===e)return t=n[i],t.idName="undefined"==typeof t.useIterator||t.useIterator?t.id+"_"+t.iteration:t.id,t;return t}function u(e){var n=0;return t.each(e.sizes,function(e,t){0===n?n=t[1]:t[1]<n&&(n=t[1])}),n}function l(e){var n=0;return t.each(e.sizes,function(e,t){t[1]>n&&(n=t[1])}),n}function g(e,i){return t.each(e.sizes,function(t,o){return o[1]<=i?!0:void(e.sizes=n.removeByKey(e.sizes,t))}),e}function f(e){var n="default";return t.each(o(),function(t,i){return i.id!==e?!0:(n=i.type,!1)}),n}function c(e){for(var t=i.get("inventory"),n=0;n<t.length;n++)if(t[n].id===e||t[n].slot===e){t[n].iteration="undefined"==typeof t[n].iteration?0:t[n].iteration+1,i.set("inventory",t);break}}{var h=!0;h?n.debug:function(){}}return{getInventory:o,getAdInfo:s,getDynamicInventory:d,shortestAvailable:u,tallestAvailable:l,limitUnitHeight:g,getUnitType:f,incrementAdSlot:c}}),function(e,t){"function"==typeof define&&define.amd?define("src/Manager",["jquery","./Util","./Config","./Inventory"],function(n,i,o,r){return t(e,n,i,o,r)}):"object"==typeof exports?module.exports=t(e,require("jquery"),require("./Util"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Manager=t(e,e.jQuery,e.AdManager.Util,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,t,n,i,o){function r(){A()&&(C=o.getInventory(),U=i.get("account"),j=i.get("adSelector"),a(),s())}function a(){t(document).on("AdManager:unitsInserted",function(){}).on("AdManager:libraryLoaded",function(){M=!0,d()}).on("AdManager:slotsDefined",function(){p()})}function d(){t.event.trigger("AdManager:initSequence"),l(),g(),f(),c(),h()}function s(){if(M)return u();var t,n,i,o=!1;e.googletag=e.googletag||{},e.googletag.cmd=e.googletag.cmd||[],t=document.createElement("script"),t.async=!0,t.type="text/javascript",n="https:"==document.location.protocol,t.src=(n?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js",t.addEventListener?t.addEventListener("load",u,!1):t.readyState&&(t.onreadystatechange=function(){o||(o=!0,u())}),i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(t,i)}function u(){googletag.cmd.push(function(){t.event.trigger("AdManager:libraryLoaded")})}function l(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",function(e){v(e)})})}function g(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad()})}function f(){googletag.cmd.push(function(){var e=i.get("targeting");e.length&&t.each(e,function(e,t){googletag.pubads().setTargeting(e,t)})})}function c(){var e=i.get("clientType"),n=t(i.get("context")),o=null,r=j;e!==!1&&(r+='[data-client-type="'+e+'"]'),o=n.find(r),o.each(function(){var e=t(this).data("id");q.push(e)})}function h(){googletag.cmd.push(function(){for(var e,n,r=null,a=t(i.get("context")),d=0;d<q.length;d++)o.incrementAdSlot(q[d]),r=o.getAdInfo(q[d]),"undefined"!=typeof r.id&&(e=a.find(j+'[data-id="'+r.id+'"]'),n=t("<div />"),e.length<1||(n.addClass(i.get("adUnitTargetClass")),n.attr("id",r.idName),e.append(n),e.addClass("active"),x[d]=googletag.defineSlot("/"+U+"/"+r.slot,r.sizes,r.idName).addService(googletag.pubads())));googletag.enableServices(),t.event.trigger("AdManager:slotsDefined")})}function p(){googletag.cmd.push(function(){googletag.pubads().refresh(x);for(var e=0;e<q.length;e++)currentPosition=o.getAdInfo(q[e]),t("#"+currentPosition.idName).length&&googletag.display(currentPosition.idName)})}function v(e){var n=e.slot.getAdUnitPath().replace("/"+U+"/",""),i=o.getAdInfo(n);t.event.trigger("AdManager:adUnitRendered",{name:n,id:i.id,size:e.size,isEmpty:e.isEmpty,creativeId:e.creativeId,lineItemId:e.lineItemId,serviceName:e.serviceName})}function y(e){var n=null;return t.each(x,function(t,i){var o=i.getAdUnitPath().replace("/"+U+"/","");return o===e?(n=i,!1):void 0}),n}function m(e){googletag.cmd.push(function(){var t=o.getAdInfo(e),n=y(t.slot);googletag.pubads().refresh([n]),googletag.display(t.idName),x=o.removeDefinedSlot(x,t.slot)})}function A(){return i.get("enabled")}function b(e){var t=e.$context,n=e.removeContainer||!1;t.find(j).empty(),n&&t.find(j).remove()}var I=!0,M=(I?n.debug:function(){},!1),x=[],q=[],C=[],U=null,j="";return{init:r,isEnabled:A,displaySlot:m,initSequence:d,emptyAds:b}}),function(e,t){"function"==typeof define&&define.amd?define("src/Insertion",["jquery","./Util","./Config","./Inventory"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("./Util"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Insertion=t(e.jQuery,e.AdManager.Util,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,t,n,i){function o(){e(document).on("AdManager:initSequence",a)}function r(){A=e(n.get("context"))}function a(){var e=i.getDynamicInventory();return M=M.length?M:e.dynamicItems,q=q?q:e.localContext,M.length?(r(),b=A.find(q).first(),b.length&&(I=!0),I?void s():d()):d()}function d(){e.event.trigger("AdManager:unitsInserted")}function s(){I&&(u(),f(),c()),d()}function u(){var t=b.children(),i=n.get("insertion.insertExclusion");t.each(function(n){var o=e(this),r=n>0?t.eq(n-1):!1,a=!0;e.each(i,function(e,t){return o.is(t)||o.find(t).length?(a=!1,!1):void 0}),r&&r.is("p")&&1===r.find("img").length&&(a=!1),o.attr("data-valid-location",a)})}function l(t){return e.parseJSON(t.data("valid-location"))}function g(t,o){o=o||!1;var r=i.getUnitType(t),a=x?"odd":"even",d=e("<div />");return d.addClass(n.get("adClass")).attr("data-id",t).attr("data-client-type",r),o?d.addClass("disable-float"):d.addClass("in-content").addClass(a),o||(x=!x),d}function f(){var e=h(),t=i.tallestAvailable(e),o=i.shortestAvailable(e),r=p({height:t,limit:n.get("insertion.adHeightLimit")}),a=null;r||(r=p({height:o,limit:n.get("insertion.adHeightLimit"),force:!0}),r.disableFloat||(e=i.limitUnitHeight(e,o))),a=g(e.id,r.disableFloat),r.$insertBefore.before(a)}function c(){e.each(M,function(e,t){var n=i.tallestAvailable(t),o=p({height:n}),r=null;return o?(r=g(t.id,o.disableFloat),void o.$insertBefore.before(r)):!1})}function h(){var n=!1;return e.each(M,function(e,i){return i.primary?(n=i,M=t.removeByKey(M,e),!1):void 0}),n||(n=M[0],M=t.removeByKey(M,0)),n}function p(t){t=t||{};var n=y(),i=new v({$nodes:n,force:t.force?t.force:!1,limit:t.limit?t.limit:!1,height:t.height});return n.length?(e.each(n,function(t,n){return!0!==i.verifyNode(t,e(n))?!0:!1}),i.locationFound?(i.markValidNodes(),i.setLastPosition(),{$insertBefore:i.$insertBefore,disableFloat:i.disableFloat}):!1):!1}function v(e){this.totalHeight=0,this.marginDifference=40,this.inserted=[],this.$insertBefore=null,this.disableFloat=!1,this.locationFound=!1,this.validHeight=0,this.exitLoop=!1,this.height=e.height,this.force=e.force,this.limit=e.limit,this.$nodes=e.$nodes,this.lastPosition=0,this.neededheight=e.height-this.marginDifference}function y(){var e=b.find(n.get("adSelector")).last(),t=null;return t=e.length?e.nextAll(b):b.children()}var m=!0,A=(m?t.debug:function(){},null),b=null,I=!1,M=[],x=!0,q=null;return v.prototype.setLastPosition=function(){this.lastPosition=this.$insertBefore.offset().top+this.neededheight},v.prototype.markValidNodes=function(){this.inserted.length&&e.each(this.inserted,function(t,n){e(n).data("valid-location",!1)})},v.prototype.verifyNode=function(e,t){var i=t.offset().top-this.lastPosition,o=t.outerHeight(),r=this.$nodes.length-1===e;return this.totalHeight+=o,this.force&&(this.totalHeight>=this.limit||r)?(this.$insertBefore=t,this.disableFloat=!0,this.locationFound=!0,this.exitLoop=!0):this.limit&&(this.totalHeight>=this.limit||r)?(this.locationFound=!1,this.exitLoop=!0):l(t)?(this.validHeight+=o,this.inserted.push(t),null===this.$insertBefore&&(this.$insertBefore=t),this.validHeight>=this.neededheight&&(!this.limit&&i<n.get("insertion.pxBetweenUnits")&&(this.validHeight=0,this.$insertBefore=null),this.locationFound=!0,this.exitLoop=!0)):(this.validHeight=0,this.$insertBefore=null,this.exitLoop=null),this.exitLoop},{init:o}}),function(e,t){if("function"==typeof define&&define.amd)define("src/Index",["./Util","./Config","./Inventory","./Manager","./Insertion"],t);else if("object"==typeof exports)module.exports=t(require("./Util"),require("./Config"),require("./Inventory"),require("./Manager"),require("./Insertion"));else{var n=e.AdManager;e.AdManager=t(n.Util,n.Config,n.Inventory,n.Manager,n.Insertion)}}(window,function(e,t,n,i,o){function r(e){if(e=e||!1,!e)throw new Error("Please provide a config.");t.init(e),o.init(),i.init()}var a=r.prototype;return a.Util=e,a.Config=t,a.Inventory=n,a.Manager=i,a.Insertion=o,r});